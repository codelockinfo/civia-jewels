{%- comment -%}
  Renders a product card

  Accepts:
  - product_card_product: {Object} Product Liquid object (optional)
  - media_size: {String} Size of the product image card. Values are "square" and "portrait". Default is "square" (optional)
  - show_secondary_image: {Boolean} Show the secondary image on hover. Default: false (optional)
  - add_image_padding: {Boolean} Enables padding on the image to space out the grid
  - show_vendor: {Boolean} Show the product vendor. Default: false

  Usage:
  {% render 'product-card', show_vendor: section.settings.show_vendor %}
{%- endcomment -%}

{%- liquid
  assign product_swatch_option = settings.swatch | downcase
  assign isColor = false
  assign variant_img = ''
  for option in product_card_product.options_with_values
    assign option_name = option.name | downcase
    if product_swatch_option contains option_name
      assign isColor = true
      assign index = forloop.index0
      assign position = forloop.index | minus: 1
      assign variant_selected = option.selected_value
      if settings.show_quick_shop
        for variant in product_card_product.variants limit: 1
          if variant.image != null
            assign variant_img = variant.image
          endif
        endfor
      endif
      break
    else
      assign position = 0
      assign variant_selected = null
    endif
  endfor

  assign media_size = settings.product_block_image_ratio
  if media_size == 'portrait'
    assign portrait_aspect_ratio = settings.portrait_height
  endif

  assign featured_media_aspect_ratio = product_card_product.featured_media.aspect_ratio
  if product_card_product.featured_media.aspect_ratio == null
    assign featured_media_aspect_ratio = 1
  endif

  assign product_action_group = false

  assign show_quick_view = false
  if settings.show_quick_view
    if settings.product_quick_view_type == 'icon' or settings.show_quick_view_mb
      assign show_quick_view = true
    endif
  endif

  assign show_wishlist = false
  if settings.show_wishlist_card and settings.show_wishlist
    assign show_wishlist = true
  elsif template.suffix == 'ajax_wishlist_card'
    assign show_wishlist = true
  endif

  assign show_compare = false
  if settings.show_compare and settings.product_compare_type == 'icon'
    assign show_compare = true
  endif

  if show_quick_view or show_wishlist or show_compare
    assign product_action_group = true
  endif

  assign has_video = product_card_product.media | where: 'media_type', 'video'

  assign card_06_button_text_color = settings.card_06_button_text_color
  assign card_06_button_background = settings.card_06_button_background
  assign card_06_button_gradient = settings.card_06_button_gradient
  assign card_06_button_border = settings.card_06_button_border
  assign card_06_button_text_color_hover = settings.card_06_button_text_color_hover
  assign card_06_button_background_hover = settings.card_06_button_background_hover
  assign card_06_button_gradient_hover = settings.card_06_button_gradient_hover
  assign card_06_button_border_hover = settings.card_06_button_border_hover

  assign show_price = settings.show_price

  assign custom_fields = product_card_product.metafields.custom.product_variant_custom
-%}
<div
  class="product-item{% if settings.disable_product_card_border %} disable_product_card_border{% endif %}"
  data-product-id="{{ product_card_product.id }}"
  data-json-product='{"id": {{product_card_product.id}},"handle": "{{product_card_product.handle}}","media": {{product.media | json | escape}},"variants": {{ product_card_product.variants | json | escape }}}'
>
  <div class="card{% if product_card_product.media[0].media_type == 'video' %} has-first-video{% endif %}">
    <div class="card-product{% if product_card_product.featured_media == nil %} card--text-only card--soft{% endif %}">
      <div class="card-product__wrapper">
        {%- if settings.show_badge -%}
          {% render 'product-badge',
            product: product_card_product,
            class: 'card__badge',
            badge_detail: true,
            serial: serial
          %}
        {%- endif -%}
        <div
          class="card-media card-media--{{ media_size }}{% if product_card_product.media[1] != nil and settings.show_image_swap %} media--hover-effect{% endif%}{% if settings.show_compare and settings.product_compare_type == 'default' %} has-compare{% endif %}{% if loading %} media--loading-effect{% endif %}"
          {% if product_card_product.featured_media %}
            {%- if media_size == 'adapt' %}
              style="padding-bottom: {{ 1 | divided_by: featured_media_aspect_ratio | times: 100 }}%;"
            {%- elsif media_size == 'square' %}
              style="padding-bottom: 100%;"
            {%- elsif media_size == 'portrait' -%}
              {%- if portrait_aspect_ratio != blank %}
                style="padding-bottom: {{ portrait_aspect_ratio | append: '%' }};"
              {%- endif -%}
            {%- endif -%}
          {% endif %}
        >
          {% render 'image-product-card',
            product_card_product: product_card_product,
            variant_img: variant_img,
            has_video: has_video,
            loading: loading
          %}
          <a
            class="card-link"
            href="{{ product_card_product.url }}"
            title="{{ product_card_product.title | escape }}"
          ></a>
        </div>

        {%- if product_action_group -%}
          <div class="card-product__group group-{{ settings.group_quickview_wishlist }}">
            {%- if show_wishlist -%}
              <div class="card-product__group-item card-wishlist">
                <button
                  type="button"
                  title="{{ 'wishlist.general.add' | t }}"
                  class="wishlist-icon{% if settings.show_wishlist_card_mb %} show-mb{% endif %}"
                  data-wishlist
                  data-wishlist-handle="{{ product_card_product.handle }}"
                  data-product-id="{{ product_card_product.id }}"
                >
                  <span class="text">{{ 'wishlist.general.add' | t }}</span> {% render 'icon-heart-2' -%}
                  {%- if settings.show_wishlist_full_icon %}{% render 'icon-heart-add' %}{% endif %}
                </button>
              </div>
            {%- endif -%}
            {%- if show_quick_view -%}
              <div class="card-product__group-item card-quickview card-quickviewIcon{% if settings.show_quick_view_mb %} show-mb{% endif %}{% if settings.product_quick_view_type == 'default' %} default{% endif %}">
                <button
                  type="button"
                  title="{{ 'products.product.quick_view' | t }}"
                  class="quickview-icon"
                  data-product-id="{{ product_card_product.id }}"
                  data-open-quick-view-popup
                  data-product-handle="{{ product_card_product.handle }}"
                >
                  <span class="text">{{ 'products.product.quick_view' | t }}</span> {% render 'icon-eyes' %}
                </button>
              </div>
            {%- endif -%}
            {%- if show_compare -%}
              {% render 'product-compare',
                product: product_card_product,
                sectionId: sectionId,
                class: 'card-product__group-item card-compare card-compareIcon'
              %}
            {%- endif -%}
          </div>
        {%- endif -%}

        {%- if settings.display_item_size -%}
          {% render 'product-item-size', product: product_card_product %}
        {%- endif -%}

        {%- if settings.show_quick_view and settings.product_quick_view_type == 'default' -%}
          <div class="card-quickview">
            <button
              type="button"
              title="{{ 'products.product.quick_view' | t }}"
              class="quickview-button button"
              data-product-id="{{ product_card_product.id }}"
              data-open-quick-view-popup
              data-product-handle="{{ product_card_product.handle }}"
            >
              {{ 'products.product.quick_view' | t }}
            </button>
          </div>
        {%- endif -%}

        {%- if settings.show_product_marquee -%}
          {%- render 'product-card-marquee', product: product_card_product -%}
        {%- endif -%}
      </div>
    </div>
    {%- if settings.show_action and complementary_product_button_atc -%}
      <div
        class="card-action card-grid__hidden{% if settings.show_compare and settings.product_compare_type == 'default' %} has-compare{% endif %}"
        data-cart-action-for-quickshop-2
      >
        {% render 'add-to-cart-form',
          product: product_card_product,
          id: 'form',
          position: position,
          sectionId: sectionId
        %}
      </div>
    {%- endif -%}
    <!-- Divider -->
    <hr class="product-divider">

    <div class="card-information">
      <div class="card-information__wrapper text-{{ settings.product_content_text_align }}">
        {%- if settings.show_vendor -%}
          <div class="card-vendor link-underline">
            <span class="visually-hidden">{{ 'accessibility.vendor' | t }}</span>
            {{- product_card_product.vendor | link_to_vendor: class: 'vendor-text' }}
          </div>
        {%- endif -%}

        <h3 class="card__heading">
          <a
            class="card-title link-underline{% if settings.product_title_line_text != 'full' %} card-title-ellipsis{% endif %}{% if variant_selected != blank %} card-title-change{% endif %}"
            href="{{ product_card_product.url }}"
            data-product-title="{{ product_card_product.title | escape }}"
            data-product-url="{{ product_card_product.url }}"
          >
            {{- product_card_product.title | escape -}}
            {%- if variant_selected != blank %}
              <span data-change-title>
                {% if settings.style_text_color_varriant == '01' %}-{% endif %}
                {{ variant_selected -}}
              </span>
            {%- endif -%}
          </a>
        </h3>

        {% render 'product-card-summary', product: product_card_product, class: 'card-list__hidden' %}

        {%- if show_price -%}
          <div class="card-price">
            {% render 'price', product: product_card_product, price_class: '', hasCountdown: hasCountdown %}
          </div>
        {%- endif -%}

        <!-- Simplified HTML for Shape & Metal Swiper Variant Section -->
        <div class="variant-section variant-section-custom">
          <!-- Shape Selector -->
          <div class="variant-group">
            <div class="variant-label">Shape</div>
            <div class="swiper variant-swiper shape-swiper">
              <div class="swiper-wrapper variant-options">
                <div class="swiper-slide variant-option" onclick="selectVariant(this, 'shape')">
                  <img src="https://cdn.shopify.com/s/files/1/0713/6598/4514/files/ROUND__DIAMOND.jpg" alt="Round">
                </div>
                <div class="swiper-slide variant-option" onclick="selectVariant(this, 'shape')">
                  <img src="https://cdn.shopify.com/s/files/1/0713/6598/4514/files/OVAL__DIAMOND.jpg" alt="Oval">
                </div>
                <!-- Add more shapes as needed -->
              </div>
              <div class="swiper-button-prev"></div>
              <div class="swiper-button-next"></div>
            </div>
          </div>

          <!-- Metal Selector -->
          <div class="variant-group">
            <div class="variant-label">Metal</div>
            <div class="swiper variant-swiper metal-swiper">
              <div class="swiper-wrapper variant-options">
                <div class="swiper-slide variant-option" onclick="selectVariant(this, 'metal')">
                  <img
                    src="https://cdn.shopify.com/s/files/1/0713/6598/4514/files/Item.png?v=1728998267"
                    alt="Rose Gold"
                  >
                </div>
                <div class="swiper-slide variant-option" onclick="selectVariant(this, 'metal')">
                  <img
                    src="https://cdn.shopify.com/s/files/1/0713/6598/4514/files/Item_1.png?v=1728998464"
                    alt="White Gold"
                  >
                </div>
                <div class="swiper-slide variant-option" onclick="selectVariant(this, 'metal')">
                  <img
                    src="https://cdn.shopify.com/s/files/1/0713/6598/4514/files/Item_2.png?v=1728998531"
                    alt="Yellow Gold"
                  >
                </div>
              </div>
              <div class="swiper-button-prev"></div>
              <div class="swiper-button-next"></div>
            </div>
          </div>
        </div>

        {%- if product_card_product.metafields.custom.positive_vibes_almost_sold_out
          or product_card_product.metafields.custom.positive_vibes_recently_people_gave_review
          or product_card_product.metafields.custom.positive_vibes_top_best_seller
        -%}
          <positive-vibes class="card-positive_vibes positive_vibes">
            <div class="text-vibes">
              {%- if product_card_product.metafields.custom.positive_vibes_almost_sold_out -%}
                <div class="text-vibes--child">
                  <p>
                    {% render 'icon-fire-3' %}
                    {{ product_card_product.metafields.custom.positive_vibes_almost_sold_out }}
                  </p>
                </div>
              {%- endif -%}
              {%- if product_card_product.metafields.custom.positive_vibes_recently_people_gave_review -%}
                <div class="text-vibes--child">
                  <p>
                    {% render 'icon-check-2' %}
                    {{ product_card_product.metafields.custom.positive_vibes_recently_people_gave_review }}
                  </p>
                </div>
              {%- endif -%}
              {%- if product_card_product.metafields.custom.positive_vibes_top_best_seller -%}
                <div class="text-vibes--child">
                  <p>
                    <span class="hot-stock">{{ 'products.product.hot_stock_text' | t }}</span>
                    {{ product_card_product.metafields.custom.positive_vibes_top_best_seller }}
                  </p>
                </div>
              {%- endif -%}
            </div>
          </positive-vibes>
        {%- endif -%}
      </div>

      {%- if settings.enable_combined_products_listing and custom_fields != blank -%}
        {% render 'combined-products-listing', product: product %}
      {%- else -%}
        {%- if isColor -%}
          {%- unless settings.show_swatch -%}
            <div class="hidden">
          {%- endunless -%}
          {% render 'product-swatch', product: product_card_product, index: index, variant_selected: variant_selected %}
          {%- unless settings.show_swatch -%}
            </div>
          {%- endunless -%}
        {%- endif -%}
      {%- endif -%}

      {%- if settings.display_text_size -%}
        {%- assign variant_size = product_card_product.options_by_name.Size.values | size -%}
        {%- if variant_size > 0 -%}
          <span class="text-size text-{{ settings.product_content_text_align }}">
            {{- 'products.product.more_sizes' | t -}}
          </span>
        {%- endif -%}
      {%- endif -%}

      {%- if settings.show_action and complementary_product_button_atc -%}
        {% render 'add-to-cart-form-category-list',
          product: product_card_product,
          id: 'form',
          list: 'list',
          position: position,
          sectionId: sectionId
        %}
      {%- endif -%}
      {%- if settings.show_compare and settings.product_compare_type == 'default' -%}
        <div class="card-compare-wrapper">
          {% render 'product-compare', product: product_card_product, sectionId: sectionId, class: 'card-compare' %}
        </div>
      {%- endif -%}
    </div>
  </div>
</div>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper/swiper-bundle.min.css">
<script src="https://cdn.jsdelivr.net/npm/swiper/swiper-bundle.min.js"></script>

<style>
  .variant-section{
    display: flex;
    flex-direction: column;
    gap: 16px;
    font-size: 14px;
  }
  .variant-group {
    display: flex;
    align-items: center;
  }
  .variant-label {
    width: 60px;
    font-size: 14px;
  }
  .variant-swiper{
    width: calc(100% - 65px);
  }
  .variant-options {
    display: flex;
    gap: 10px;
  }
  .variant-option {
    width: 36px;
    height: 36px;
    border: 2px solid transparent;
    border-radius: 50%;
    overflow: hidden;
    cursor: pointer;
    transition: border 0.3s;
  }
  .variant-option.active {
    border-color: #000;
  }
  .variant-option img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    border-radius: 50%;
  }
  .swiper-button-next, .swiper-button-prev {
    color: #000;
  }
  .variant-swiper {
    padding: 0px 0;
  }
  .divider {
    border-top: 1px solid #ddd;
    margin: 20px 0;
  }
</style>

<script>
  function selectVariant(el, type) {
    document.querySelectorAll('.variant-option').forEach(opt => opt.classList.remove('active'));
    el.classList.add('active');
    // Do something with selected value if needed
  }

  new Swiper('.shape-swiper', {
    slidesPerView: 'auto',
    spaceBetween: 10,
    navigation: {
      nextEl: '.shape-swiper .swiper-button-next',
      prevEl: '.shape-swiper .swiper-button-prev',
    },
  });

  new Swiper('.metal-swiper', {
    slidesPerView: 'auto',
    spaceBetween: 10,
    navigation: {
      nextEl: '.metal-swiper .swiper-button-next',
      prevEl: '.metal-swiper .swiper-button-prev',
    },
  });
</script>
